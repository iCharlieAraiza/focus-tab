<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="css/style.css">
    <title>Your task</title>
</head>
<body>
    <div class="background-img">
        <img src="./assets/img/background/leaves.jpg" />
    </div>
    <main>
        <section class="card-wrapper">
            <div class="container">
                <div class="card">
                    <h3 class="figure">
                        19
                    </h3>
                    <h3 class="name">
                        today
                    </h3>
                </div>
                <div class="card">
                    <h3 class="figure">
                        9
                    </h3>
                    <h3 class="name">
                        Pending
                    </h3>
                </div>
                <div class="card">
                    <h3 class="figure" id="accumulatedTime">
                        0:00
                    </h3>
                    <h3 class="name">
                        Time
                    </h3>
                </div>
                <div class="card">
                    <h3 class="figure" id="sessions">
                        0
                    </h3>
                    <h3 class="name">
                        Sessions
                    </h3>
                </div>
                <div class="card">
                    <h3 class="figure">
                        <span class="icon">
                            <img src="/assets/img/weather/rainy.png" alt="">
                        </span>
                        10&deg;c
                    </h3>
                    <h3 class="name">
                        Pending
                    </h3>
                </div>
            </div>
        </section>
        <section class="main-section">
            <div class="clock-container active">
                <div class="button-container col-5">
                    <ul>
                        <li>Timer <span id="pomodoro-config"><img src="assets/img/icons/config.png" alt="" srcset=""></span></li>
                    </ul>
                </div>
                <div class="timer">
                    <div class="time">25:00 </div>
                    <div class="button" id="play">
                        <img src="/assets/img/icons/play-button.png" alt="" srcset="">
                    </div>
                    <div class="button" id="stop">
                        <img src="/assets/img/icons/stop-button.png" alt="" srcset="">
                    </div>
                </div>
                <div class="clock">
                    <div class="time"> <span class="time-stamp"></span> <span class="meridian"></span></div>
                </div>
            </div>
            <div class="task-container col-5">
                <div class="tab-section">
                    <div class="tab active">
                        <div class="title">
                            Today
                        </div>
                        <div class="todo-container">
                            <ul id="listContainer">
                                <li>
                                    <span class="select-circle"></span>
                                    <div class="title-task">New Task</div>
                                </li>
                                <li>
                                    <span class="select-circle"></span>
                                    <div class="title-task">New Task</div>
                                </li>
                            </ul>
                        </div>
                        <div class="todo-form">
                            <div class="action-title">
                                <span>Create a new task</span>
                            </div>

                            <div class="add-form"> 
                                <input type="text" placeholder="+  New task" id="taskform">
                            </div> 
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <section id="pomodoro-settings" class="modal">
            <div class="form-container">
                <div class="head-section">
                    <div id="closeModal">
                        &#x2715;
                    </div>
                    <div class="wrapper">
                        <h2>Pomodoro Settings</h2>
                        <div class="description">Timer settings</div>
                        <form action="">
                            <div class="form-group">
                                <div class="title-form">
                                    Time (minutes)
                                </div>
                                <div class="row">
                                    <div class="form-section col-3">
                                        <label for="">Pomodoro</label>
                                        <div class="input-container">
                                            <input type="number" id="pomodoroInput" min="0" value="25">
                                        </div>
                                    </div>
                                    <div class="form-section col-3">
                                        <label for="">Short break</label>
                                        <div class="input-container">
                                            <input type="number" min="0" value="5">
                                        </div>
                                    </div>
                                    <div class="form-section col-3">
                                        <label for="">Long break</label>
                                        <div class="input-container">
                                            <input type="number" min="0" value="15">
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="form-group">
                                <div class="title-form">
                                    Configuration
                                </div>
                                <div class="row">
                                    <div class="form-section col-3">
                                        <label for="">Alarm sound</label>
                                        <div class="input-container">
                                            <select id="sounds" name="sounds">
                                                <option value="beep">Beep</option>
                                                <option value="classical">classical</option>
                                            </select>                                        </div>
                                        </div>
                                    <div class="form-section col-3">
                                        <label for="">Long break interval</label>
                                        <div class="input-container">
                                            <input type="number" min="0" value="5">
                                        </div>
                                    </div>
                                    <div class="form-section col-3">
                                    </div>
                                </div>
                            </div>
                            <div class="form-group">
                                <div class="row">
                                    <div class="form-section col-3">
                                        <label for="">Autostart session</label>
                                        <div class="input-container">
                                            <label class="switch">
                                                <input type="checkbox">
                                                <span class="slider round"></span>
                                            </label>                                                                                  
                                        </div>
                                    </div>
                                    <div class="form-section col-3">
                                        <label for="">Autostart break</label>
                                        <div class="input-container">
                                            <label class="switch">
                                                <input type="checkbox" checked>
                                                <span class="slider round"></span>
                                            </label>                                               </div>
                                    </div>
                                    <div class="form-section col-3">
                                    </div>
                                </div>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </section>
    </main>
    <audio id="pressSound" src="/assets/audio/button-press.wav"></audio>
    <audio id="bellSound" src="/assets/audio/bell.wav"></audio>
<script>
    
    let sessionValue = 25,
        breakValue = 3,
        sessions = 0,
        accumulatedTime = 0;
    
    /*
        Modal
    */


    const modal = document.getElementById('pomodoro-settings')
    const closeBtn = document.getElementById('closeModal')
    const configBtn = document.getElementById('pomodoro-config')
    const pomodoroInput = document.getElementById('pomodoroInput')
    
    const pressSound = document.getElementById('pressSound')
    const bellSound = document.getElementById('bellSound')

    sessionValue = pomodoroInput.value * 60

    let sessionTime = sessionValue,
        breakTime = breakValue,
        active = false,
        interval = '',
        runningTime = 0,
        isBreak = false

    pomodoroInput.addEventListener('change', ()=>{
        sessionValue = pomodoroInput.value * 60
        initialize()
    })

    closeBtn.onclick = ()=>{
        modal.classList.toggle('active')
    }

    configBtn.onclick = ()=>{
        modal.classList.toggle('active')
    }



    const timer = document.querySelector('.timer .time')
    const clock = document.querySelector('.clock .time')
    const play = document.querySelector('#play')
    const stop = document.querySelector('#stop')

    const tittle = document.querySelector('title')

    let startTime = 0
    let currentTime = 0;

    

    play.onclick = ()=>{
        pressSound.play();
        active = !active
        if(active)
            start();
        else
            pause();
    }

    stop.onclick = ()=>{
        if(active){
            reset();
            timer.textContent = calculateTime(sessionValue)
        }
    }


    /*
    const start = ()=>{
        startTime = Date.now() - runningTime
        interval = setInterval(()=>{
            const time = Date.now() - startTime
            currentTime =  sessionTime - ( Math.floor(time / 1000) ) 
            timer.textContent = calculateTime(currentTime)
            if(currentTime===0 && !isBreak){
                isBreak = true
                sessionTime = breakTime
                startTime = Date.now()
            }else if(currentTime===0 ){
                pause()
                console.log('Finish')
            }
        },1000)
    }
    */

    const initialize = ()=>{
        sessionTime = sessionValue
        const time = sessionTime == 0 ? 25*60 : sessionTime
        timer.innerText = calculateTime(time)
    }


    const start = ()=>{
        console.log('Click')
        interval = setInterval(()=>{
            console.log(accumulatedTime)
            currentTime =  sessionTime - runningTime++
            accumulatedTime++
            timer.textContent = calculateTime(currentTime)
            tittle.textContent = calculateTime(currentTime)
            if(currentTime===0 && !isBreak){
                bellSound.play();
                setBreak()
            }else if(currentTime===0 ){
                bellSound.play();
                reset()
                sessions++
                updateSessions()
                updateAccumulatedTime()
            }
        },1000)
    }

    const pause = ()=>{
        clearInterval(interval)
    }

    const setBreak = ()=>{
        isBreak = true
        sessionTime = breakTime
        runningTime = 0
    }

    const reset = ()=>{
        pause()
        isBreak = false
        console.log('Finish')
        runningTime = 0
        sessionTime = sessionValue
        active = false
    }

    const updateSessions = ()=>{
        const sessionsLabel = document.getElementById('sessions')
        sessionsLabel.textContent = sessions
    }

    const updateAccumulatedTime = ()=>{ 
        document.getElementById('accumulatedTime')
                .innerText = calculateTimeByMinutes(accumulatedTime)
    }

    const calculateTime = value => {
        const sec = parseInt(value, 10); 
        let hours = Math.floor(sec / 3600); 
        let minutes = Math.floor((sec - hours * 3600) / 60); 
        let seconds = sec - hours * 3600 - minutes * 60;
        if (hours < 10) {      hours = '0' + hours;    }
        if ( (hours * 60) + minutes < 10 ) { minutes = `0${minutes}`}
        if (seconds < 10) {      seconds = '0' + seconds;    }
        if (hours == 0) {
        return minutes + ':' + seconds; // Return in MM:SS format
        } else {
        return  ( (hours * 60) + minutes) + ':' + seconds; // Return in HH:MM:SS format
        }
    }

    const calculateTimeByMinutes = (seconds)=>{
        if(seconds < 60){
            return '0:00'
        }
        let hours = Math.floor(seconds / 3600);
        let minutes = Math.floor((seconds - hours * 3600) / 60);
        minutes = minutes < 10 ? '0' + minutes : minutes

        return `${hours}:${minutes}`
    }
    
    console.log( calculateTime(0) )
    
    /*
        Execution flow
    */

    initialize();


    
    /*
    fetch('http://example.com/movies.json')
    .then(response => response.json())
    .then(data => console.log(data));

   
        Set time
    */

    
    /*
    play.onclick = ()=>{
        active = !active
        const interval = setInterval(()=>{
            if(!active){
                clearInterval(interval)
            } 
            if(seconds <= 0){
                if(breakTime <= 0){
                    clearInterval(interval)
                }   
                timer.innerHTML = timeFormat(breakTime--)
            }else{
                timer.innerHTML = timeFormat(seconds--)
            }
        },1000)        
    }

    */
    

    /*
        Create a Clock
    */



    setInterval(()=>{
        const today = new Date(); 
        let hours = today.getHours()
        let medridian = ''
        let minutes = today.getMinutes() < 10 ? `0${today.getMinutes()}` : today.getMinutes()
        
        if(hours > 12){
            hours = hours - 12
            meridian = 'PM'
        }else{
            hours = hours < 10 ? `0${hours}` : hours
            meridian = 'AM'
        }   
        clock.textContent = `${hours}:${minutes} ${meridian}`
    },1000)

    /*
    let hours = today.getHours()
    let medridian = ''
    
    if(hours > 12){
        hours = hours - 12
        meridian = 'PM'
    }else{
        meridian = 'AM'
    }   

    console.log( `${hours}:${today.getMinutes()} ${meridian}` )

    //console.log(hours + ":" + today.getMinutes())



    /*
        To-do App
    */

    const taskList = [{}];

    const taskform = document.querySelector('#taskform'),
    listContainer = document.querySelector('#listContainer')

    taskform.addEventListener('change', (event)=>{
        taskList.push({status:active, value:taskform.value})

        let newList = '';

        taskList.fo

        listContainer.innerHTML =  '';

    })


    


</script>
</body>
</html>